---
title: "Partitions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Partitions}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r, echo = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

This vignette shows how to use the partitions package to perform entity resolution with categorical variables using partition-based Bayesian clustering models.

## Datasets

The data set *Italy* is available to the user after the packaged is installed. 

* This data set is constructed from the Survey on Household Income and Wealth (SHIW), conducted by the Bank of Italy every two years. We use the 2008 and 2010 databases
from the Fruili region, which consists of 789 records combined. Ground truth is available via unique
identifiers based upon social security numbers; roughly 74% of the clusters are singletons. The true number of unique records is 587.

The datasets can be loaded as follows:
```{r, eval=TRUE}
library(partitions)
data(Italy)
```
The object `Italy` contains the records and `Id_Italy` the ground truth for the partition of the data. The values of the fields of this dataset are already remapped to consecutive integers but this is not required in advance.

```{r, eval=TRUE}
tail(Italy, rownames=TRUE)
tail(Id_Italy)
```

## Partition Priors

The package contains the implemetation of four random partition models that are used to perform entitiy resolution as a clustering task: 

* Two traditional random partition models: Dirichlet process (DP) mixtures and Pitmanâ€“Yor process (PY) mixtures. 
* Two random partition models that exhibit the microclustering property, referred to as: The ESCNB model and the ESCD model.

## Posterior Samples

To obtain posterior samples of the cluster assignments and the model parameters the user needs to specify the data, the random partition Prior ("DP", "PY" or "ESCNB"), the burn-in period, the number of iterations and the truncation value for the prior of the distortion probabilities of the fields (usually a small positive value $< 0.1$): 

```{r, eval=TRUE}
PosNB <- SampleCluster(data=Italy, Prior="ESCNB", burn=5, nsamples=10, truncds=0.01)
```

The output is a list with two elements: 

* `Z`: A matrix of size nsamples x N containing the samples of the cluster assignments.
* `Params`: A matrix of size nsamples x # of model parameters containing the samples of the model parameters. The columns named beta_1 to beta_L  correspond to the distortion probabilities of the fields in the data.

```{r, eval=TRUE}
PosNB$Z[1:5,1:10]
head(PosNB$Params)
```

The distortion probabilities can also be fixed at the `truncds` value by specifying `samds=FALSE`:

```{r, eval=FALSE}
PosNB <- SampleCluster(data=Italy, Prior="ESCNB", burn=5, nsamples=10, truncds=0.01, samds = FALSE)
```

Samples for the "DP" and "PY" models can be similarly obtained as:

```{r, eval=FALSE}
PosDP <- SampleCluster(Italy, "DP", 5, 10, 0.01)
PosPY <- SampleCluster(Italy, "PY", 5, 10, 0.01)
```

To obtain samples from the ESCD model, the `SampleClusterESCD` function should be used instead.
```{r, eval=TRUE}
PosD <- SampleClusterESCD(Italy, burn=5, nsamples=10, truncds=0.01)
PosD$Z[1:5,1:10]
head(PosD$Params)
```

## Error rates 

If the ground truth for the partition of the data is available, the False Negative Rate (FNR) and False Discovery Rate (FDR) can be computed (for any model) using the `calcError` function:
```{r, eval=TRUE}
calcError(PosD$Z, Id_Italy$id)
```

