---
title: "Partitions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Partitions}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r, echo = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

This vignette shows how to use the partitions package to perform entity resolution with categorical variables using partition-based Bayesian clustering models.

## Partition Priors

The package contains the implemetation of four random partition models that are used to perform entitiy resolution as a clustering task: 

* Two traditional random partition models: Dirichlet process (DP) mixtures and Pitmanâ€“Yor process (PY) mixtures. 
* Two random partition models that exhibit the microclustering property, referred to as: The ESCNB model and the ESCD model.

## Posterior Samples

To obtain posterior samples of the cluster assignments and the model parameters the user needs to specify the data, the random partition Prior ("DP", "PY", "ESCNB" or "ESCD"), the burn-in period, and the number of iterations: 

```{r, eval=TRUE}
# true partition to generate simulated data
# 50 clusters of each size, max cluster size is 4
true_L<-c(50,50,50,50)
# number of fields
nfields <- 5
# number of cartegories per field
ncat <- rep(10,5)
# distortion probability for the fields
true_beta <- 0.01
library('partitions')
# generate simulated data
x <- SimData(trueL, nfields, ncat, true_beta)
PosESCD <- SampleCluster(data=x, Prior="ESCD", burn=5, nsamples=10)
```

The output is a list with two elements: 

* `Z`: A matrix of size nsamples x N containing the samples of the cluster assignments.
* `Params`: A matrix of size nsamples x # of model parameters containing the samples of the model parameters. The columns named beta_1 to beta_L  correspond to the distortion probabilities of the fields in the data.

```{r, eval=TRUE}
PosESCD$Z[1:5,1:10]
head(PosESCD$Params)
```

Samples for the DP,PY, and ESCNB models can be similarly obtained as:

```{r, eval=FALSE}
PosDP <- SampleCluster(x, "DP", 5, 10)
PosPY <- SampleCluster(x, "PY", 5, 10)
PosESCNB <- SampleCluster(x, "ESCNB", 5, 10)
```

## Error rates 

If the ground truth for the partition of the data is available, the average False Negative Rate (FNR) and False Discovery Rate (FDR) over the posterior samples can be computed (for any model) using the `mean_fnr` and `mean_fdr` functions:
```{r, eval=TRUE}
true_M <- length(true_L)
true_K <- sum(true_L)
# true cluster assignments
id <- rep(1:true_K, times=rep(1:true_M, times=true_L))
# average fnr
mean_fnr(PosESCD$Z,id)
# average fdr
mean_fdr(PosESCD$Z,id)
```

